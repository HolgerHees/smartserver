# **** DEFAULT Variables ***
#
# - Variables a 'default' attribute are assigned as global facts if there is no custom variable defined
# - Variables without a 'default' attribute are MANDATORY except there is a 'optional' attribute
# - If the 'optional' attribute applies to False it behaves like a MANDATORY variable.
# - If the 'optional' attribute applies to TRUE, the 'optional' attribute is a 'template term' and the variable is defined. You will see a warning about a leftover variable which can be cleaned.
#
# **************************
default_variables: {
    location:                                 {},                                                                   # "52.3476672,13.6215805" => latitude / longitude
    timezone:                                 {},                                                                   # "Europe/Berlin"
    language:                                 {},                                                                   # "en", "de" ...
    country:                                  {},                                                                   # "EN", "DE" ...
    region:                                   {},                                                                   # "bb" => berlin / brandenburg => https://www.openhab.org/docs/configuration/actions.html#ephemeris
    
    root_email:                               {},                                                                   # "testadmin@test.com" => gets all admin / alert / warning emails from your server

    server_name:                              {},                                                                   # "test"
    server_domain:                            {},                                                                   # "smartserver.test"
    
    ssl_certificate:                          { default: "selfsigned" },                                            # "selfsigned", "letsencrypt"
    
    production_ip:                            {},                                                                   # "192.168.7.50" your server ip
    staging_ip:                               { default: "" },                                                      # "192.168.8.50" your testserver ip

    ipv6_enabled:                             { default: no },

    intern_networks:                          { default: [] },                                                      # e.g. intern (trusted) ipv4 & ipv6 address ranges. Networks, based on production/staging ip and ansible server ip, be added additionally.
    public_networks:                          { default: [] },                                                      # e.g. public ipv6 address ranges

    root_path:                                { default: "/smartserver/" },                                         # path for smartserver related service data
    data_path:                                { default: "{{root_path}}data/" },                                    # path for smartserver related user data
    backup_path:                              { default: "{{data_path}}backups/" },                                 # path for local backup data

    # used in main role 'apache' and can be an empty array []
    authenticated_ip_addresses:               { default: [] },                                                      # apache access always allowed for ipaddresses e.g. from wallmounted tablets
    
    public_domain:                            { default: "public.{{server_domain}}" },

    userdata: {},
    # *** EXAMPLE for userdata ***
    # {
    #     testuser1: {
    #         name: "Test User 1"                                                                                   # mandatory.
    #         email: "test1@test.de"                                                                                # mandatory.
    #         groups: [ "admin", "user" ]                                                                           # mandatory.
    #         telegram_bot: {                                                                                       # optional. used by openhab => reference to bot key in vault.yml
    #             bot_testuser1
    #         },
    #         phone_device: {                                                                                       # optional. used by device_ping role
    #             ip: "{{default_server_subnet}}.69",
    #             timeout: 60
    #         },
    #         vpn_gates: {                                                                                          # optional. used by wireguard_mobile role
    #             "phone: "{{vpn_mobile_subnet}}.11",
    #             "tablet: "{{vpn_mobile_subnet}}.12"
    #         },
    #         media_dir: {                                                                                          # optional. nextcloud user folder which is available via dlna (can be any nextcloud subfolder)
    #             "test_media: "/"
    #         }
    #     }
    # }
    
    vault_userpasswords: {},
    # *** EXAMPLE for vault_userpasswords ***
    # {
    #     testuser1: {
    #         samba_password: "<mysambapassword>",
    #         web_password: "<mywebpassword>"
    #     }
    # }

    network_devices: { default: [] },                                                                               # used for librenms, system_service (network monitoring) and openwrt => they are preprocessed at the end of this config file
    # *** EXAMPLE for network_devices ***
    # [
    #     {
    #         host: { optional: yes },                                                                              # "{{default_server_subnet}}.100"
    #         name: { optional: yes },                                                                              # "WLan AP Inhouse" => will be used in webui for openwrt devices
    #         snmp_method: { optional: yes },                                                                       # "v2c"
    #         snmp_community_string: { optional: yes }                                                              # "public"
    #         type: { optional: yes }                                                                               # 'openwrt', 'fritzbox', or absend
    #         config: { optional: yes }                                                                             # only related to openwrt deployment
    #     }
    # ]

    vault_deployment_config_git:              { default: "https://github.com/HolgerHees/smartserver.git" },         # used deployment, update_service and ci_service role
    vault_deployment_token_git:               { optional: yes },                                                    # used in update_service or ci_service in case of a private repository


    # >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    # *** BEGIN OUTGOING MAIL SERVER                                                   ***
    # Roles:
    # - 'postfix'
    vault_mailserver_username:                {},                                                                   # "testusername@test.com", "testadmin@test.com" ... => username from your email server
    vault_mailserver_password:                {},                                                                   # "<mypassword>" => password from your email server
    vault_mailserver_host:                    {},                                                                   # "smtp.gmail.com" => smtp address from your email server
    vault_mailserver_port:                    {},                                                                   # "587" => smtp port from your email server
    # *** END OUTGOING MAIL SERVER                                                     ***
    # <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<


    # >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    # *** BEGIN APACHE AUTH                                                            ***
    # for details how to configure, check: https://github.com/zmartzone/mod_auth_openidc
    # to enable openid connect for google, go to: https://console.developers.google.com/apis/credentials
    # Roles:
    # - 'apache'
    vault_openid_connect_url:                 { optional: yes },                                                    # 'optional' means disabled is not defined, to enable check documentation urls to get the right values
    vault_openid_connect_client_id:           { optional: yes },
    vault_openid_connect_client_secret:       { optional: yes },
    vault_openid_connect_passphrase:          { optional: yes },

    vault_form_auth_passphrase:               {},                                                                   # "8924jkhf2/8?23" => a random phrase which is used by form based apache login to encrypt sessions
    # *** END APACHE AUTH                                                              ***
    # <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<


    # >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    # *** BEGIN SAMBA                                                                  ***
    # Roles:
    # - 'samba'
    samba_enabled:                            { default: yes },                                                     # enabled by default
    # *** END SAMBA                                                                    ***
    # <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<


    # >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    # *** BEGIN MONITORING                                                             ***
    # Roles:
    # - 'fluentd'
    # - 'prometheus'
    # - 'alertmanager'
    # - 'systemd_watcher'
    # - 'hardware_mdadm'
    # - 'hardware_smartd'
    # - 'hardware_sensors'
    monitoring_enabled:                       { default: yes },                                                     # enabled by default

    # Roles:
    # - 'grafana'
    grafana_enabled:                          { default: yes },                                                     # enabled by default
    vault_grafana_app_username:               { default: "admin",
                                                optional: "{{not grafana_enabled}}" },

    # Roles:
    # - 'netdata'
    netdata_enabled:                          { default: yes,                                                       # enabled by default
                                                dependency: "influxdb_enabled" },
    # *** END MONITORING                                                               ***
    # <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<


    # >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    # **** BEGIN LIBRENMS                                                              ***
    # Roles:
    # - 'librenms'
    librenms_enabled:                         { default: "{{librenms_devices | length > 0}}",
                                                dependency: "mysql_enabled,redis_enabled" },                        # enabled if there are network_devices with attribute 'snmp_method'
    librenms_poller_interval:                 { default: 5,                                                         # interval in minutes
                                                optional: "{{not librenms_enabled}}" },
    vault_librenms_mysql_username:            { default: "librenms",
                                                optional: "{{not librenms_enabled}}" },
    vault_librenms_mysql_password:            { optional: "{{not librenms_enabled}}" },
    vault_librenms_api_token:                 { optional: "{{not librenms_enabled}}" },
    # **** END LIBRENMS                                                                ***
    # <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<


    # >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    # *** BEGIN DNS SERVER                                                             ***
    # There is always a dns service (dnsmasq) running to resolve *.<server_domain> to this server and forwards everthing else to dns_forward_ip_addresses
    # Roles:
    # - 'dnsmasq'
    # - 'pihole'

    # The default flow is <pihole:pihole_ip:53> forwards to <dnsmasq:server_ip:53> forwards to <dns_forward_ip_addresses>
    # In this way you can decided, by choosing pihole or dnsmasq, if you want adblocking enabled or not for your device
    # All local containers/services using 'dnsmasq'

    dns_forward_ip_addresses:                 { default: [ "8.8.8.8", "8.8.4.4" ] },                                # used by dnsmasq

    # This extends 'dnsmasq' or 'pihole' to acts as a full dns server, with custom entries
    dns_enabled:                              { default: "{{dns_type is defined}}" },                               # enabled by define a 'dns_type'
    dns_type:                                 { optional: yes },                                                    # 'dnsmasq' or 'pihole' (pihole_ip must be defined)
    dns_overrides:                            { default: [],
                                                optional: "{{not dns_enabled}}" },
     # *** EXAMPLE for dns_overrides ***
     # [
     #     {ip: {{default_server_subnet}}.73, custom_dns: "tv.other.domain.com"}
     # ]
    dns_default_domain:                       { default: "lan", optional: "{{not dns_enabled}}" },

    # This enables dhcp for 'dnsmasq' or 'pihole'
    dhcp_enabled:                             { default: "{{dhcp_type is defined}}" },                              # enabled by define a 'dhcp_type'
    dhcp_type:                                { optional: yes },                                                    # 'dnsmasq' or 'pihole' (pihole_ip must be defined)
    dhcp_range_start:                         { default: "{{default_server_subnet}}.151",
                                                optional: "{{not dhcp_enabled}}" },
    dhcp_range_end:                           { default: "{{default_server_subnet}}.200",
                                                optional: "{{not dhcp_enabled}}" },
    dhcp_reservations:                        { default: [],                                                        # dhcp entries
                                                optional: "{{not dhcp_enabled}}" },
     # *** EXAMPLE for dhcp_reservations ***
     # [
     #     { mac: 12:34:56:78:90:11, ip: {{default_server_subnet}}.73, hostname: tv-livingroom, custom_dns: ["smarttv"]}
     # ]
    dhcp_dns_server:                          { default: "{{ pihole_ip if pihole_ip is defined else default_server_ip }}",
                                                optional: "{{not dhcp_enabled}}" },

    # Pihole and dlna ip's should be part of a contiguous area at the end of your server network
    # This contiguous area is configured as a subnet which is routed completely to a virtual macvlan bridge interface and is not usable for other device ip's anymore
    pihole_enabled:                           { default: "{{pihole_ip is defined}}" },
    pihole_ip:                                { optional: yes },                                                    # pihole ip address from same network as your server ip
    pihole_ipv6:                              { optional: yes },                                                    # pihole ipv6 address from same network as your server ip
    pihole_whitelist_domains:                 { default: [ "www.googleadservices.com", "analytics.google.com", "clickserve.dartsearch.net", "ad.doubleclick.net" ],
                                                optional: "{{not pihole_enabled}}" },                               # domains are needed to use google search results
    pihole_addlist_urls:                      { default: [ "https://raw.githubusercontent.com/StevenBlack/hosts/master/hosts", "https://raw.githubusercontent.com/StevenBlack/hosts/master/alternates/fakenews-only/hosts", "https://raw.githubusercontent.com/StevenBlack/hosts/master/alternates/gambling-only/hosts" ],
                                                optional: "{{not pihole_enabled}}" },
    vault_pihole_password:                    { optional: "{{not pihole_enabled}}" },                               # used to login into pihole
    # *** END DNS SERVER                                                               ***
    # <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<


    # >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    # *** BEGIN VPN                                                                    ***
    # Used in generic optional role 'wireguard_mobile'
    # Roles:
    # - 'wireguard_mobile'
    mobile_vpn_enabled:                       { default: "yes" },                                                   # enabled by default
    mobile_vpn_internal_port:                 { default: "51828",
                                                optional: "{{not mobile_vpn_enabled}}" },                           # the port, used on your server
    mobile_vpn_public_port:                   { optional: "{{not mobile_vpn_enabled}}" },                           # the public port, reachable from outside. (e.g. forwarded port on your dsl router)
    # to complete the setup you have to configure port forwarding on your internet router where you forward the public port to your internal port
    # *** END VPN                                                                      ***
    # <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<


    # >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    # *** BEGIN DATABASES                                                              ***
    # Roles:
    # - 'influxdb'
    influxdb_enabled:                         { default: yes },                                                     # enabled by default, be careful with disabling and check dependencies before.
    vault_influxdb_admin_username:            { default: "admin",                                                   # used to login into influxdb webui
                                                optional: "{{not influxdb_enabled}}" },
    vault_influxdb_admin_password:            { optional: "{{not influxdb_enabled}}" },
    vault_influxdb_admin_token:               { optional: "{{not influxdb_enabled}}" },                             # "lkjfdh7123kjas" => token used for internal command line operations

    # Roles:
    # - 'mysql'
    mysql_enabled:                            { default: yes },                                                     # enabled by default, be careful with disabling and check dependencies before.
    vault_shared_mysql_username:              { default: "shared",                                                  # used for internal data
                                                optional: "{{not mysql_enabled}}" },
    vault_shared_mysql_password:              { optional: "{{not mysql_enabled}}" },

    # Roles:
    # - 'redis'
    redis_enabled:                            { default: yes },                                                     # enabled by default, be careful with disabling and check dependencies before.

    # Roles:
    # - 'mosquitto'
    mosquitto_enabled:                        { default: yes },                                                     # enabled by default, be careful with disabling and check dependencies before.
    # *** END DATABASES                                                                ***
    # <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<


    # >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    # *** BEGIN DLNA SERVER                                                            ***
    # Roles:
    # - 'minidlna'
    dlna_enabled:                             { default: "{{dlna_ip is defined and ( dlna_volumes | length ) > 0}}"},
    dlna_ip:                                  { optional: yes },                                                    # dlna ip address from same network as your server ip
    dlna_ipv6:                                { optional: yes },                                                    # dlna ipv6 address from same network as your server ip
    # *** END DLNA SERVER                                                              ***
    # <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<


    # >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    # *** BEGIN NEXTCLOUD                                                              ***
    # Roles:
    # - 'nextcloud'
    # - 'nextcloud_libreoffice'
    nextcloud_enabled:                        { default: yes,                                                       # enabled by default
                                                dependency: "mysql_enabled,redis_enabled" },
    vault_nextcloud_instance_id:              { optional: "{{not nextcloud_enabled}}" },                            # "234sdgzw87399443s" => used internally
    vault_nextcloud_password_salt:            { optional: "{{not nextcloud_enabled}}" },                            # "9ad9aus92z4ij20j20idj928912hd1jd0"
    vault_nextcloud_secret:                   { optional: "{{not nextcloud_enabled}}" },                            # "890w3hf083hfuishf8834uf938jtoi23j3r928ur982rj2in3diuhe2u1423984uu23jh4ji23n2ji3nd23092i293u20293r9jujiuaawf"
    vault_nextcloud_mysql_username:           { default: "nextcloud",                                               # used for nextcloud data
                                                optional: "{{not nextcloud_enabled}}" },
    vault_nextcloud_mysql_password:           { optional: "{{not nextcloud_enabled}}" },
    vault_nextcloud_admin_username:           { default: "admin",                                                   # used to login as a nextcloud data
                                                optional: "{{not nextcloud_enabled}}" },
    vault_nextcloud_admin_password:           { optional: "{{not nextcloud_enabled}}" },
    nextcloud_additional_apps:                { default: [],                                                        # additional apps for nextcloud
                                                optional: "{{not nextcloud_enabled}}" },
    # *** EXAMPLE for nextcloud_additional_apps ***
    # [
    #     {
    #         "app: { optional: yes },                                                                              # app id. e.g. "cookbook"
    #         "name: { optional: yes },                                                                             # webui menu name. e.g. "Cookbook"
    #         "description: { optional: yes },                                                                      # webui menu info. e.g. "Recipes"
    #         "icon: { optional: yes },                                                                             # webui icon. e.g. "icons/nextcloud_cookbook.svg"
    #
    #         "usergroups: { default: [] }                                                                          # optional. limit visibility to specific groups or users. e.g. ["admin", "user", "<username>"]
    #         "order: { default: 200 }                                                                              # optional. control order in webui menu
    #     }
    # ]
    # *** END NEXTCLOUD                                                                ***
    # <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<


    # >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    # *** BEGIN OPENHAB                                                                ***
    # Roles:
    # - 'openhab'
    # - 'openhab_toolbox'
    openhab_enabled:                          { default: yes,                                                       # enabled by default
                                                dependency: "mysql_enabled,influxdb_enabled,mosquitto_enabled" },
    vault_openhab_config_git:                 { optional: "{{not openhab_enabled}}" },                              # a cloned git url of "https://github.com/HolgerHees/openhab-config.git"
    vault_openhab_mysql_username:             { default: "openhab",                                                 # used for openhab data
                                                optional: "{{not openhab_enabled}}" },
    vault_openhab_mysql_password:             { optional: "{{not openhab_enabled}}" },
    # *** END OPENHAB                                                                  ***
    # <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<


    # >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    # *** BEGIN CAMMERA SERVICE                                                        ***
    # Roles:
    # - 'camera_service'
    # - 'camera_ftp'
    camera_enabled:                           { default: "{{camera_devices | length > 0}}" },                       # enabled if there are camera devices configured
    camera_devices:                           { default: [] },                                                      # used for ftp upload, image gallkery and menu entries
    # *** EXAMPLE for camera_devices ***
    # [
    #     {
    #         uid: {},                                                                                              # unique identifier for this device. Will be used to generate proxy urls like /camera{uid | capelized}Image
    #         name: {},                                                                                             # menu and gallery name
    #         details: { optional: yes },                                                                           # additional details like brand name
    #         ftp_upload_name: { optional: yes },                                                                   # the folder name where alert images are uploaded int the ftp folder (it is just the subfolder name, not the whole path)
    #         snapshot_url: {},                                                                                     # external url to get a snapshot/preview image
    #         snapshot_username: { optional: yes }                                                                  # username to authenticate external url
    #         snapshot_password: { optional: yes }                                                                  # password to authenticate external url
    #     }
    # ]
    vault_ftp_username:                       { optional: "{{not camera_enabled}}" },                               # "ftp" => used for e.g. camera image uploads ('optional' means disabled is not defined)
    vault_ftp_password:                       { optional: "{{not camera_enabled}}" },
    ftp_max_file_age:                         { default: "{{2 * 24 * 60}}",                                         # images, older then 2 days are discarded
                                                optional: "{{not camera_enabled}}" },
    # **** END CAMERA SERVICE                                                          ***
    # <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<


    # >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    # **** BEGIN UPDATE SERVICE                                                        ***
    # Roles:
    # - 'update_service'
    update_service_enabled:                   { default: "{{ update_service_software_check_enabled or update_service_system_check_enabled}}" }, # enabled is system check or software check
    update_service_software_check_enabled:    { default: yes },                                                     # enables the update check for software (version check of running containers) used inside deployment roles / container
    update_service_software_check_email:      { optional: yes },                                                    # "testadmin@test.com" => sends a notification email after each check, if new software is available
    update_service_system_check_enabled:      { default: yes },                                                     # enables the update check (os updates or smartserver updates) for this deployment
    update_service_system_check_email:        { optional: yes },                                                    # "testadmin@test.com" => sends a notification email after each check, if new smartserver deployment updates are available
    # **** END UPDATE SERVICE                                                          ***
    # <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<


    # >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    # **** BEGIN SYSTEM SERVICE                                                        ***
    # Roles:
    # - 'system_service'
    system_service_enabled:                   { default: yes,                                                       # enabled by default
                                                dependency: "influxdb_enabled,mosquitto_enabled" },

    fping_test_hosts:                         { default: [ "8.8.8.8" ],                                             # reachability check in system_service
                                                optional: "{{not system_service_enabled}}" },

    default_isp:                              { default: {},                                                        # is used to detect a fallback internet connection in system_service
                                                optional: "{{not system_service_enabled}}" },
    # *** EXAMPLE for default_isp ***
    # {
    #     org: [ ".+ Sverige AB" ],                                                                                 # external ip must be registered to a organisation or isp named ".+ Sverige AB"
    #     hostname: [ ".+d1-online\\\\.com" ],                                                                      # external ip must be resolved to a spcific dns name
    #     ip: [ "185\\\\.89\\\\.36\\\\.[0-9]{1-3}" ]                                                                # fixed external ip ranges
    # }

    traffic_blocker:                          { default: yes,                                                       # enabled or disabled automatic ip blocking based on several decissions (additionally there must be a propper configured 'netflow_incoming_traffic' variable)
                                                optional: "{{not system_service_enabled}}" },
    # 1. if suspicious traffic arrives the apache webserver => which traffic, can be configured in the variable 'netflow_incoming_traffic' and the attribute 'log'
    # 2. if unexcpected traffic arrives the network  => which traffic, can be configured  in the variable 'netflow_incoming_traffic' and the attribute 'allowed'
    netflow_collector:                        { default: no,                                                        # enable netflow collector in system_service
                                                optional: "{{not system_service_enabled}}" },
    netflow_incoming_traffic:                 { default: [],                                                        # from internet expected and allowed traffic, (used to detect netflow traffic direction and for traffic blocker to decide which traffic is suspicious)
                                                optional: "{{not system_service_enabled}}" },
    # *** EXAMPLE ***
    # {
    #   { target: "{{production_ip}}:80", name: "http", allowed: { hostname: [ ".+\\\\.internetnord\\\\.de", ".+letsencrypt\\\\.org" ] }, log="apache" }, # Letsencrypt, CLOUD PING Test
    #   { target: "{{production_ip}}:10114", name: "alexa api", allowed: { org: [ "AWS EC2 .+" ] }, log="apache" }, # ALEXA
    #   { target: "{{production_ip}}:51820", name: "wireguard", allowed: { wireguard_peers: [ "check" ] } }, # system check for connected wireguard peers
    #   { target: "{{production_ip}}:456", name: "test", allowed: { ip: [ "185\\\\.89\\\\.36\\\\.[0-9]{1-3}" ] } }, # Fixed IP range test
    # }
    #
    # *** Attibute Explanation ***
    # 'logs' => "apache" means, traffic to this 'target' is additionally collected and analysed from apache logs
    # 'allowed' => various regexes agains hostnames, org (ISP) or ip to mark traffic as normal. Type 'wireguard_peers' means the traffic ip is compared with active wireguard endpoints
    # 'name' is just used as an identifier
    # 'target' is a combination of the target ip and port number
    external_speedtest_server_id:             { default: "auto",                                                    # used for system_service speedtest
                                                optional: "{{not system_service_enabled}}" },

    vault_openwrt_api_username:               { default: "api",
                                                optional: "{{not system_service_enabled or openwrt_devices | length == 0}}" },
    vault_openwrt_api_password:               { optional: "{{not system_service_enabled or openwrt_devices | length == 0}}" },
    #"vault_openwrt_root_password:             { optional: "{{openwrt_devices | length == 0}}" },

    vault_fritzbox_api_username:              { default: "api",
                                                optional: "{{not system_service_enabled or fritzbox_devices | length == 0}}" },
    vault_fritzbox_api_password:              { optional: "{{not system_service_enabled or fritzbox_devices | length == 0}}" },
    # **** END SYSTEM SERVICE                                                          ***
    # <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<


    # >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    # **** BEGIN LOCAL BACKUP SERVICE                                                  ***
    # This service runs rsync to copy {{root_path}} to {{backup_path}}environment/, excluding 'var', 'tmp', 'build' and {{data_path}}
    # Roles:
    # - 'backup_rsync'
    local_backup_enabled:                     { default: yes },                                                     # enabled by default
    # **** END LOCAL BACKUP SERVICE                                                    ***
    # <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<


    # >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    # **** BEGIN INHOUSE SPEEDTEST SERVICE                                             ***
    # This service provides a speedtest like https://www.speedtest.net/ but localy hosted
    # Additionally, it provides a iperf (https://en.wikipedia.org/wiki/Iperf) endpoint
    # Roles:
    # - 'speedtest'
    speedtest_enabled:                        { default: yes },                                                     # enabled by default
    # **** END INHOUSE SPEEDTEST SERVICE                                               ***
    # <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<


    # >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    # *** BEGIN WEATHER SERVICE                                                        ***
    # There are 2 modes how you can run weather service. Local mode and cloud mode
    # 1. If you enable weather service, you run the local mode by default. Here you fetch the data from openmeteo and published via the local mqtt to the weather consumer
    # 2. If you specify the weather_mqtt_server as 'cloud_mosquitto' you can share the data with an additional cloud instance.
    # The reason why it is based on mqtt, because the data can be shared with friend via the cloud service or other services like openhab
    # Roles:
    # - 'weather_service'
    weather_service_enabled:                  { default: yes,                                                       # enabled by default
                                                dependency: "mysql_enabled{{',mosquitto_enabled' if weather_mqtt_server == 'mosquitto' else ''}}" },
    weather_api_provider:                     { default: "openmeteo",                                               # 'openmeteo' (https://open-meteo.com/), 'meteogroup' (https://api.weather.mg/ => needs credentials) or 'listener'
                                                optional: "{{not weather_service_enabled}}" },
    weather_mqtt_server:                      { default: "mosquitto",                                               # 'mosquitto' or 'cloud_mosquitto'
                                                optional: "{{not weather_service_enabled}}" },
    weather_mqtt_publish_topic:               { default: "{{server_name}}",
                                                optional: "{{not weather_service_enabled or weather_api_provider == 'listener'}}" }, # the main topic prefix where you publish weather data
    vault_weather_api_username:               { optional: "{{not weather_service_enabled or weather_api_provider != 'meteogroup'}}" },
    vault_weather_api_password:               { optional: "{{not weather_service_enabled or weather_api_provider != 'meteogroup'}}" },
    # *** END WEATHER SERVICE                                                          ***
    # <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<


    # >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    # **** BEGIN GUEST WIFI BARCODE GENERATOR                                          ***
    # This generates a webui menu entry which shows a barcode, to make it easy for your guests to connect
    # Roles:
    # - 'weather_service'
    guest_wifi_enabled:                       { default: "{{vault_wifi_networks is defined and vault_wifi_networks | length > 0}}" },
    vault_wifi_networks:                      { optional: yes },
    # {
    #     test1: { password: "1234", type: "public" },
    #     test2: { password: "3456", type: "intern" }
    # }
    # **** END GUEST WIFI BARCODE GENERATOR                                            ***
    # <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<


    # ####################################################################################
    # ### BELOW ARE BY DEFAULT NOT INCLUDED ROLES                                      ###
    # ### 1. They are activated it they are imported manually in your custom roles.yml ###
    # ### 2. You have to configure related variables below                             ###
    # ####################################################################################


    # >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    # *** BEGIN PRIVATE CLOUD SERVICE                                                  ***
    # This service provides a private cloud network between several smartserver instances share data and backups
    # Roles:
    # - 'wireguard_cloud'
    # - 'cloud_nfs'
    # - 'cloud_mosquitto'
    # - 'cloud_check'
    # - 'backup_cloud'
    # Related variable is 'cloud_vpn'
    # *** EXAMPLE ***
    # cloud_vpn: {
    #    name: "peer1",
    #    interface: { address: "{{vpn_cloud_subnet}}.0.1", port: "51829", network: "{{vpn_cloud_subnet}}.1.0/24" },
    #    peers: {
    #         peer2: { address: "{{vpn_cloud_subnet}}.0.2", port: "51829", network: "{{vpn_cloud_subnet}}.2.0/24", host: "public.peer2.com", notification_email: "test@peer2.com" },
    #         peer3: { address: "{{vpn_cloud_subnet}}.0.3", port: "51829", network: "{{vpn_cloud_subnet}}.3.0/24", host: "public.peer3.com", notification_email: "test@peer3.com" }
    #    }
    # }
    # *** END PRIVATE CLOUD SERVICE                                                    ***
    # <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<


    # >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    # **** BEGIN OPENWRT CONFIG GENERATOR                                              ***
    # The role is used to preprocess and generate openwrt configurations which can be deployed to openwrt devices like access points, gateways or switches
    # The openwrt configurations can be found in {{global_etc}}openwrt/ap/ including a script 'deploy.sh'
    # Related role is
    # - 'openwrt'
    # Related variable 'network_devices' which is preprocessed into 'openwrt_devices' end of this config file
    # *** EXAMPLE ***
    # network_devices: [
    #    {
    #       host: "{{default_server_subnet}}.1",
    #       name: "Gateway",
    #       type: "openwrt",
    #       config: { roles: ["gateway"], features: [ "ipv6-to-hosts", "softflowd", "ddns" ], install_packages: "kmod-usb-net-cdc-ether usb-modeswitch", remove_packages: [ "ntpclient" ] }
    #    },
    #    {
    #       host: "{{default_server_subnet}}.137",
    #       name: "Wlan AP Garden",
    #       type: "openwrt",
    #       config: { roles: ["ap"], features: [ "custom_ap" ] }
    #    }
    # ]
    #
    # **** END OPENWRT CONFIG GENERATOR                                                ***
    # <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<


    # >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    # **** BEGIN CI SERVICE                                                            ***
    # This services runs various continues integration deployments in a virtual machine on suse, alma and ubuntu
    # Roles:
    # - 'ci_service'
    # **** END CI SERVICE                                                              ***
    # <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<


    # >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    # **** BEGIN VCONTROLD SERVICE                                                     ***
    # This service communicates with Viessmann heating systems and published values and cmd's to mosquitto
    # Roles:
    # - 'vcontrol'
    # Related variables are 'vault_deployment_config_git' and 'vault_deployment_token_git'
    # **** END VCONTROLD SERVICE                                                       ***
    # <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
}

project_name:                     "smartserver"

# version of alpine linux used in several container based roles
alpine_version:                   "3.19.1"

flask_core_version:               "3.0.0"
flask_socketio_version:           "5.3.6"

htdocs_path:                      "{{root_path}}htdocs/"
global_etc:                       "{{root_path}}etc/"
global_tmp:                       "{{root_path}}tmp/"
global_build:                     "{{root_path}}build/"
global_log:                       "{{root_path}}var/log/"
global_lib:                       "{{root_path}}var/lib/"

projects_path:                    "{{data_path}}projects/"
cloud_path:                       "{{data_path}}cloud/"

deployment_path:                  "{{projects_path}}{{project_name}}/"

deployment_config_path:           "{{deployment_path}}{{config_path}}"
deployment_inventory_path:        "{{ansible_inventory_sources[0]}}"

nextcloud_data_path:              "{{data_path}}nextcloud/"

samba_master:                     "{%if is_production%}yes{%else%}no{%endif%}"

# used for e.g. openwrt's md5 password crypt
default_password_salt:            "{{((server_domain+':'+default_server_ip) | b64encode | replace(';','0') )[:-1]}}"

docker_base_network:              "172.16.0.0"
docker_base_gateway:              "172.16.0.1"
docker_dns_ip:                    "172.16.0.100"
docker_postfix_ip:                "172.16.0.101"
docker_influxdb_ip:               "172.16.0.103"
docker_redis_ip:                  "172.16.0.104"
docker_mysql_ip:                  "172.16.0.105"
docker_mosquitto_ip:              "172.16.0.106"
docker_speedtest_ip:              "172.16.0.107"
docker_libreoffice_ip:            "172.16.0.108"
docker_alertmanager_ip:           "172.16.0.109"
docker_loki_ip:                   "172.16.0.110"
docker_fluentd_ip:                "172.16.0.111"
docker_php_ip:                    "172.16.0.112"
docker_librenms_ip:               "172.16.0.113"
docker_prometheus_ip:             "172.16.0.114"
docker_grafana_ip:                "172.16.0.115"

docker_cloud_mosquitto_ip:        "172.16.0.200"
docker_weather_service_ip:        "172.16.0.201"
docker_cloud_check_ip:            "172.16.0.202"
docker_camera_ftp_ip:             "172.16.0.203"
docker_camera_service_ip:         "172.16.0.204"

docker_vcontrold_ip:              "172.16.0.230"

netgroup:                         "{{default_server_ip.split('.')[2]}}"

vpn_mobile_network:               "10.100.{{netgroup}}.0"
vpn_mobile_subnet:                "10.100.{{netgroup}}"

vpn_cloud_subnet:                 "10.101"
vpn_cloud_services:               "{
{% if cloud_vpn is defined %}
  \"local\": {
      \"bridge\": \"{{cloud_vpn.interface.network.split('.')[:3] | join('.')}}.1\",
      \"gateway\": \"{{cloud_vpn.interface.network.split('.')[:3] | join('.')}}.2\",
      \"nfs\": \"{{cloud_vpn.interface.network.split('.')[:3] | join('.')}}.3\",
      \"mosquitto\": \"{{cloud_vpn.interface.network.split('.')[:3] | join('.')}}.4\"
  },
  \"remote\": {
      {% for peer in cloud_vpn.peers %}
      \"{{peer}}\": {
          \"bridge\": \"{{cloud_vpn.peers[peer].network.split('.')[:3] | join('.')}}.1\",
          \"gateway\": \"{{cloud_vpn.peers[peer].network.split('.')[:3] | join('.')}}.2\",
          \"nfs\": \"{{cloud_vpn.peers[peer].network.split('.')[:3] | join('.')}}.3\",
          \"mosquitto\": \"{{cloud_vpn.peers[peer].network.split('.')[:3] | join('.')}}.4\"
      },
      {% endfor %}
  }
{% endif %}
}"

macvlan_ips:                      "[
{% if pihole_ip is defined %}'{{pihole_ip}}',{% endif %}
{% if dlna_ip is defined %}'{{dlna_ip}}',{% endif %}
]"

macvlan_range: "{% if macvlan_ips | length > 0 %}{{macvlan_ips | cidr_merge('span')}}{% else %}{% endif %}"

#- name: detect macvlan subnet
#  debug:
#    msg: "{{macvlan_range}}"

dlna_volumes:                    "{
{% for username in userdata %}
{% if userdata[username].media_dir is defined %}
{% for media_name in userdata[username].media_dir %}
  \"{{nextcloud_data_path}}{{username}}/files/{{userdata[username].media_dir[media_name]}}\": \"/media/{{media_name}}\",
{% endfor %}
{% endif %}
{% endfor %}
}"


librenms_devices: "{{network_devices | default([]) | selectattr('snmp_method', 'defined') | list}}"
openwrt_devices: "{{network_devices | default([]) | selectattr('type', 'defined') | selectattr('type','==','openwrt') | list}}"
fritzbox_devices: "{{network_devices | default([]) | selectattr('type', 'defined') | selectattr('type','==','fritzbox') | list}}"


