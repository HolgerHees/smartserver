<match docker.influxdb>
  @type rewrite_tag_filter
  <rule>
    key container_log
    pattern ^\[httpd\](.+)$
    tag ${tag}.httpd
  </rule>
  <rule>
    key container_log
    pattern ^ts=(.+)$
    tag ${tag}.service
  </rule>
  <rule>
    key container_log
    pattern /.+/
    tag ${tag}.unknown
  </rule>
</match>

<filter docker.influxdb.httpd>
  @type record_modifier
  <record>
    level INFO
    message ${record['container_log']}
  </record>
</filter>

<filter docker.influxdb.service>
  @type parser
  key_name container_log
  reserve_data true
  #inject_key_prefix container_
  <parse>
    @type regexp
    expression /^ts=(?<time>[^ ]*) lvl=(?<level>[^ ]*) (?<message>.*)$/
  </parse>
</filter>
<filter docker.influxdb.service>
  @type record_modifier
  <replace>
    key level
    expression /^error$/
    replace ERROR
  </replace>
  <replace>
    key level
    expression /^warn$/
    replace WARN
  </replace>
  <replace>
    key level
    expression /^info$/
    replace INFO
  </replace>
  <replace>
    key level
    expression /^debug$/
    replace DEBUG
  </replace>
  <replace>
    key level
    expression /^((?!ERROR|WARN|INFO|DEBUG).)*$/
    replace UNKNOWN
  </replace>
</filter>
