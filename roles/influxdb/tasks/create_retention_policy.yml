#https://bostik.iki.fi/aivoituksia/projects/influxdb-cascaded-downsampling.html

- name: prepare retention policy
  template:
    src: "roles/influxdb/templates/retention_policy.sql"
    dest: "{{ global_build }}influxdb/retention_policy_{{database}}.sql"
    owner: root
    group: root
    mode: 0644
  register: retention_policy

- name: create retention policy
  shell: "cat {{ global_build }}influxdb/retention_policy_{{database}}.sql | docker exec -i influxdb sh -c \"influx -database '{{database}}'\""
  when: "retention_policy.changed"
