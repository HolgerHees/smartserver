# DataDisk rsync
- name: prepare needed folder
  file:
    path: '{{backup_path}}environment'
    state: directory
    owner: root
    group: root
    
- name: create cron job => is_production
  vars:
    name: "DataDisk RSync Backup"
    cmd: "systemd-run -p CPUQuota=\"30\\%\" -p IOReadBandwidthMax=\"{{root_path}} 10M\" -p IOReadIOPSMax=\"{{root_path}} 80\" -p IOWriteBandwidthMax=\"{{root_path}} 10M\" -p IOWriteIOPSMax=\"{{root_path}} 80\" -p IOReadBandwidthMax=\"{{backup_path}}environment/ 10M\" -p IOReadIOPSMax=\"{{backup_path}}environment/ 80\" -p IOWriteBandwidthMax=\"{{backup_path}}environment/ 10M\" -p IOWriteIOPSMax=\"{{backup_path}}environment/ 80\" --quiet --scope /usr/bin/rsync --quiet -av --one-file-system --delete --exclude=build --exclude=tmp --exclude=var --exclude={{data_path | replace(root_path,'') }} {{root_path}} {{backup_path}}environment/"
    file: "ansible_rsync_backup"
    hour: "5"
    minute: "0"
  include_tasks: roles/cron/shared/add_cronjob.yml
  when: "is_production"
