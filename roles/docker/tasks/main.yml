- name: install required packages
  zypper:
    name: [
        docker,
        python2-docker  # used by ansible docker module
    ]
    state: present
  notify: "restart docker"

- name: copy config
  template:
    src: "roles/docker/templates/etc/docker/{{item}}"
    dest: "/etc/docker/{{item}}"
    owner: root
    group: root
    mode: 0644
  with_items:
    - daemon.json
  notify: "restart docker"

- name: copy fluentd config
  template:
    src: "roles/docker/templates/etc/fluent/_.ansible.d/_docker.conf"
    dest: "/etc/fluent/_.ansible.d/_docker.conf"
    owner: root
    group: root
    mode: 0640
  notify: "restart fluentd"
  
- name: check enabled docker
  systemd:
    enabled: yes
    name: docker
