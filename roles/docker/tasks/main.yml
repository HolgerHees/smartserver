- name: install base packages
  yum:
    name: [
        docker
        , python3-docker  # used by ansible docker module
    ]
    state: present
  when: ansible_distribution == 'Fedora'
  notify: "restart docker"
  
- name: install required packages
  zypper:
    name: [
        docker
        , python2-docker  # used by ansible docker module
        #, python3-docker  # used by ansible docker module
    ]
    state: present
  when: ansible_distribution == 'openSUSE Leap'
  notify: "restart docker"

- name: copy config
  template:
    src: "roles/docker/templates/etc/docker/daemon.json"
    dest: "/etc/docker/daemon.json"
    owner: root
    group: root
    mode: 0644
  notify: "restart docker"

- name: copy fluentd config
  template:
    src: "roles/docker/templates/etc/fluent/_.ansible.d/docker.conf"
    dest: "/etc/fluent/_.ansible.d/docker.conf"
    owner: root
    group: root
    mode: 0640
  notify: "restart fluentd"
  tags: ['fluentd']  
