- name: install required packages
  zypper:
    name: [
        docker,
        python2-docker  # used by ansible docker module
    ]
    state: present
  notify: "restart docker"

- name: prepare needed folder
  file:
    path: '/etc/docker/'
    state: directory
    owner: root
    group: root
    mode: 0755
    
- name: copy config
  template:
    src: "roles/docker/templates/etc/{{item}}"
    dest: "/etc/docker/{{item}}"
    owner: root
    group: root
    mode: 0644
  with_items:
    - docker/daemon.json
  notify: "restart docker"

- name: copy fluentd config
  template:
    src: "roles/docker/templates/etc/fluent/_.ansible.d/docker.conf"
    dest: "/etc/fluent/_.ansible.d/docker.conf"
    owner: root
    group: root
    mode: 0640
  notify: "restart fluentd"
  tags: ['fluentd']  
