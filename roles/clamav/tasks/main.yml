- name: add zypper repository
  zypper_repository:
    name: Security (clamav)
    repo: "http://download.opensuse.org/repositories/security/openSUSE_Leap_{{ansible_distribution_version}}/"
    auto_import_keys: yes
    priority: "100"
    state: present

- name: install required packages
  zypper:
    name: clamav>=0.101.2
    state: present
  register: install_status
  notify: "restart clamav"

- name: load initial database
  shell: '/usr/bin/freshclam --no-warnings'
  notify: "restart clamav"
  when: install_status.changed

- name: change clamd startup timeout
  lineinfile:
    path: /usr/lib/systemd/system/clamd.service
    insertafter: '^\[Service\]'
    regexp: 'TimeoutSec'
    line: 'TimeoutSec=5min'
  notify: "restart clamav"
