- name: "grafana : wait_until_ready : check if running"
  command: "systemctl is-active --quiet grafana"
  register: "service_result"
  changed_when: no
  failed_when: no

- name: "grafana : wait_until_ready : start service"
  systemd:
    name: grafana
    state: started
    daemon_reload: yes
  when: "service_result.rc != 0"

- name: "grafana : wait to become ready"
  command: "podman exec grafana sh -c 'grafana cli'"
  register: check_result
  retries: 300
  delay: 1
  until: "check_result.rc == 0"
  changed_when: "service_result.rc != 0"
