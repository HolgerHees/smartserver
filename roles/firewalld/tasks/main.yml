- name: install required fedora packages
  yum:
    name: "firewall-config"
    state: present
  when: ansible_distribution == 'Fedora'

- name: install required suse packages
  zypper:
    name: "firewall-config"
    state: present
  when: ansible_distribution == 'openSUSE Leap'

- name: copy zone config
  template:
    src: "roles/firewalld/templates/etc/firewalld/zones/{{item}}"
    dest: "/etc/firewalld/zones/{{item}}"
    owner: root
    group: root
    mode: 0640
  with_items:
    - cloud.xml
    - public.xml
    - trusted.xml
  notify: "restart firewalld"

- name: allow vagrant ip 10.0.2.2
  lineinfile:
    path: /etc/firewalld/zones/trusted.xml
    insertbefore: "<masquerade/>"
    regexp: '<source address="10\.0\.2\.2"/>'
    line: '<source address="10.0.2.2"/>'
  notify: "restart firewalld"
  when: not is_production
