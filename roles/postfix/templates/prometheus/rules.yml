groups:
- name: postfix
  rules:
  - alert: Postfix availability
    expr: 'postfix_up{job="postfix"} != 1'
    for: 0m
    labels:
      notifyGroup: "postfix"
      severity: critical
    annotations:
      summary: "Mailserver down"

  - alert: Postfix deferred queue
    expr: 'postfix_showq_message_age_seconds_sum{job="postfix", queue="deferred"} > 900'
    for: 0m
    labels:
      notifyGroup: "postfix"
      severity: critical
    annotations:
      summary: "Mailserver not able to send mails for more then 15 minutes"

  - alert: Postfix successful
    expr: 'sum_over_time(postfix_showq_message_size_bytes_count{queue="active"}[24h]) == 0'
    for: 0m
    labels:
      notifyGroup: "postfix"
      severity: critical
    annotations:
      summary: "Mailserver handled no mails during the last 24 hours"
