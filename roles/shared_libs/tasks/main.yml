- name: prepare needed folder
  file:
    path: "{{item.path}}"
    state: directory
    owner: "{{item.owner}}"
    group: "{{item.group}}"
    mode: "{{item.mode}}"
  with_items:
    - {mode: "u=rwX,g=rX,o=", owner: "root", group: "root", path: "/opt/shared/" }
    - {mode: "u=rwX,g=rX,o=rX", owner: "{{system_users['www'].name}}", group: "{{system_groups['www'].name}}", path: "{{htdocs_path}}/shared/" }

- name: synchronize libs
  synchronize:
    src: "templates/libs/shared"
    dest: "/opt/"
    archive: no
    checksum: yes
    group: yes
    perms: yes
    recursive: yes
    rsync_opts:
      - "--chown=root:root"
      - "--chmod=D750,F640"

- name: synchronize web libs
  synchronize:
    src: "templates/htdocs/shared"
    dest: "{{htdocs_path}}"
    archive: no
    checksum: yes
    group: yes
    perms: yes
    recursive: yes
    rsync_opts:
      - "--chown={{system_users['www'].name}}:{{system_groups['www'].name}}"
      - "--chmod=D755,F644"
