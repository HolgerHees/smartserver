- name: clone git
  git:
#    accept_hostkey: yes
    repo: 'https://github.com/jythontools/jython.git'
    dest: '/opt/jython'
    # commit key from 27.09.2018
    version: '1454169f3186780fd996c3d8d44d9024ee3e9642'
  register: clone_status

# async jython build is used to show progress and prevent travisci killing our job because of inactivity
- name: run install => clone status changed
  shell: 'ant installer'
  args:
    chdir: '/opt/jython'
  async: 900
  poll: 0
  register: jython_build
  when: clone_status.changed

- name: wait for jython build => clone status changed
  async_status: jid={{ jython_build.ansible_job_id }}
  register: job_result
  until: job_result.finished
  retries: 30
  delay: 60
  when: clone_status.changed
