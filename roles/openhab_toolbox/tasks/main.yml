- name: clone git
  vars:
    git_clone_name: "toolbox"
    git_clone_path: "{{projects_path}}toolbox"
    git_clone_url: "https://github.com/HolgerHees/toolbox.git"
  import_tasks: roles/_shared/tasks/git_clone.yml

- name: copy system config
  template:
    src: "templates/system.php"
    dest: "{{projects_path}}toolbox/_lib/config/system.php"
    owner: "{{system_users['www'].name}}"
    group: "{{system_groups['www'].name}}"
    mode: 0640

- name: check environment config
  shell: "ls {{projects_path}}openhab_config/toolbox/environment.php"
  register: environment_result
  changed_when: no
  failed_when: no

- name: synchronize environment config
  synchronize:
    src: "{{projects_path}}openhab_config/toolbox/environment.php"
    dest: "{{projects_path}}toolbox/_lib/config/environment.php"
    archive: no
    checksum: yes
    group: yes
    perms: yes
    recursive: yes
    rsync_opts:
      - "--chown={{system_users['www'].name}}:{{system_groups['www'].name}}"
      - "--chmod=D755,F644"
  when: "environment_result.rc == 0"
