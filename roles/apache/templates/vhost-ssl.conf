<VirtualHost *:443>
	ServerName {{subdomain}}.{{server_domain}}
	
    SSLEngine On
    SSLCertificateFile /etc/certbot/live/{{server_domain}}/fullchain.pem
	SSLCertificateKeyFile /etc/certbot/live/{{server_domain}}/privkey.pem

    Header always set Strict-Transport-Security "max-age=15768000; includeSubDomains; preload"

    OIDCProviderMetadataURL {{vault_openid_connect_url}}
    OIDCClientID {{vault_openid_connect_client_id}}
    OIDCClientSecret {{vault_openid_connect_client_secret}}

    # OIDCRedirectURI is a vanity URL that must point to a path protected by this module but must NOT point to any content
    OIDCRedirectURI https://{{subdomain}}.{{server_domain}}/redirect_uri
    OIDCCryptoPassphrase {{vault_openid_connect_passphrase}}

    <Location />
        AuthType openid-connect
        Require valid-user
    </Location>
</VirtualHost>