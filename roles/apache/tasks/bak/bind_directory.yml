- name: check "{{target_path}}" directory
  command: "mountpoint -q {{target_path}}"
  register: target_exists
  changed_when: "target_exists.rc != 0"
  failed_when: "target_exists.stderr!=''"

- name: mount "{{source_path}}" directory
  mount:
    src: "{{source_path}}"
    path: "{{target_path}}"
    opts: bind
    state: mounted
    fstype: none
  notify: "restart apache2"
  when: "target_exists.rc != 0"

- name: read service facts
  service_facts:
  when: "target_exists.rc != 0"

- name: restart to activate mount
  systemd:
    state: restarted
    name: apache2
  when: "target_exists.rc != 0 and ansible_facts.services[\"apache2.service\"].state == 'running'"
