- name: set config
  lineinfile:
    path: /etc/ssh/sshd_config
    regexp: '^{{item.field}} '
    line: '{{item.field}} {{item.value}}'
  with_items:
    - { field: 'AllowUsers', value: '*@{{server_network}}/24 *@{{cloud_net1_network}}/24 *@{{cloud_net2_network}}/24 *@{{mobile_vpn_network}}/24 vpn' }
  when: "is_production|bool"
  notify: "restart sshd"
  
- name: set config (including vagrant ip 10.0.2.2)
  lineinfile:
    path: /etc/ssh/sshd_config
    regexp: '^{{item.field}} '
    line: '{{item.field}} {{item.value}}'
  with_items:
    - { field: 'AllowUsers', value: '*@10.0.2.2 *@{{server_network}}/24 *@{{cloud_net1_network}}/24 *@{{cloud_net2_network}}/24 *@{{mobile_vpn_network}}/24 vpn' }
  when: not is_production
  notify: "restart sshd"
