- name: set config
  lineinfile:
    path: /etc/ssh/sshd_config
    regexp: '^{{item.field}} '
    line: '{{item.field}} {{item.value}}'
  with_items:
    - { field: 'AllowUsers', value: "{{ '*@' + default_gateway + ' ' if not default_gateway.startswith(server_subnet) else '' }}*@{{intern_networks | join(' *@')}} *@{{vpn_mobile_network}}/24" }
  notify: "restart sshd"

# ***** FINALIZE *****
- name: register service watcher
  vars:
    name: "sshd"
  import_tasks: roles/systemd_watcher/tasks/add_watcher.yml

- name: trigger sshd handler
  vars:
    notify: "restart sshd"
    service: "sshd.service"
  import_tasks: roles/_shared/tasks/service_check.yml
