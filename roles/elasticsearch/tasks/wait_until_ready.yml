- name: check elasticsearch is running
  systemd:
    name: elasticsearch
    state: started
  changed_when: yes
  
- name: wait for elasticsearch port becomes ready
  wait_for:
    port: 9200
  changed_when: yes

- name: wait for elasticsearch status becomes ready
  uri:
    url: "http://localhost:9200/_cluster/health?wait_for_status=yellow&timeout=60s"
    status_code: 200
  register: result
  until: result.status == 200
  timeout: 60
  retries: 5
  delay: 1
  changed_when: yes

  
  
  
