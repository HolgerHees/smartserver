[Unit]
Description={{container_name}}
StartLimitBurst=12
StartLimitIntervalSec=180
Wants=network-online.target
After=network-online.target{% if container_after is defined and container_after != None %}{% for dependency_name in container_after %} {{dependency_name}}{% if '.' not in dependency_name %}.service{% endif %}{% endfor %}{% endif +%}

[Service]
TimeoutStartSec=0
TimeoutStopSec={{container_stop_timeout | default('300')}}
Restart=on-failure
RestartSec=10
#RestartSteps=4
#RestartMaxDelaySec=60
{% if nftables_enabled %}Environment=NETAVARK_FW=none
{% endif %}
ExecStart=/usr/bin/podman start -a {{container_name}}
{% if container_pre_exec is defined and container_pre_exec != None %}ExecStartPre={{container_pre_exec}}
{% endif %}
{% if not nftables_enabled %}ExecStartPost=nohup /bin/bash -c "(sleep 1 && /opt/container/clean_iptables.sh) &"
{% endif %}
ExecStartPost=nohup /bin/bash -c "(sleep 1 && /opt/container/update_gateways --container={{container_name}} --gateway=default{% if container_routes is defined and container_routes != None %}{% for route in container_routes %} --gateway={{route.subnet}}:{{route.gateway}}{% endfor %}{% endif %}) &"
{% if container_post_exec is defined and container_post_exec != None %}ExecStartPost={{container_post_exec}}
{% endif %}
ExecStop=/usr/bin/podman stop {{container_name}}
#ExecStop=/usr/bin/podman stop -t {{container_stop_timeout | default('300')}} {{container_name}}
{% if container_reload_exec is defined and container_reload_exec != None %}ExecReload={{container_reload_exec}}
{% endif %}
#SyslogIdentifier={{container_name}}
StandardOutput=null
StandardError=null

[Install]
WantedBy=multi-user.target
