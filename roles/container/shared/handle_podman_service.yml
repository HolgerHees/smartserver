- name: "container : handle_podman_service : stop systemd service"
  systemd:
    name: "{{container_name}}"
    state: stopped
    enabled: yes
    masked: no
  failed_when: no
  when: "container_changed"

- name: "container : add_podman_service : create systemd service"
  copy:
    content: "{{ lookup('template', 'roles/container/templates/podman_service') }}"
    dest: "/etc/systemd/system/{{container_name}}.service"
    owner: root
    group: root
    mode: 0644
  notify: "restart {{trigger_name | default(container_name)}}"

- name: "container : add_podman_service : register systemd service watcher"
  vars:
    watcher_name: "{{container_name}}"
  include_tasks: roles/systemd_watcher/shared/add_watcher.yml
  tags: ['systemd_watcher_config']
  when: "monitoring_enabled"

- name: "container : handle_podman_service : trigger systemd service"
  vars:
    notify: "restart {{container_name}}"
    service: "{{container_name}}"
  include_tasks: roles/_shared/service_check.yml
