- name: connect to docker network {{network_name}}
  docker_network:
    name: "{{network_name}}"
    connected: "{{network_container}}"
    appends: yes
  register: network_result

- name: refresh networks
  command: "/opt/docker/update_network_hosts --network={{network_name}}"
  when: "network_result.changed"

- name: fix default gateways
  command: "/opt/docker/update_gateways --container={{item}} --gateway=default"
  register: gateway_result
  changed_when: "'add default' in gateway_result.stdout"
  with_items: "{{network_container}}"
  when: "network_result.changed"
