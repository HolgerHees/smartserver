- name: check if {{git_clone_name}} git is updateable => ! (directory exists, is not empty and contains not commited or not pushed changes)
  shell: "[ -d '{{git_clone_path}}' ] && cd {{git_clone_path}} && [ `ls -1A .  | wc -l` -gt 0 ] && ! sudo -u {{ git_sudo_user | default('root') }} git diff-index --quiet origin/master"
  register: "_git_clone_result"
  changed_when: "_git_clone_result.rc == 0"
  failed_when: "_git_clone_result.rc > 1"

# no folder => 1
# no uncommited changes => 1
# no unpushed changes => 1

#- name: debug
#  debug:
#    msg: "{{_git_clone_result}}"

- name: clone {{git_clone_name}} git
  git:
#    accept_hostkey: yes
    repo: '{{git_clone_url}}'
    dest: '{{git_clone_path}}'
    version: 'master'
  vars:
    ansible_remote_tmp: "/tmp"
  become_user: "{{ git_sudo_user | default('root')}}"
  register: "git_clone_result"
  when: "_git_clone_result.rc == 1"
 
- name: register result state
  set_fact:
    git_clone_changed: "{{ git_clone_result.changed }}"
