domain (ip ip6) {
    table filter {
        chain ("/^NETAVARK.*/" NETAVARK_INPUT NETAVARK_FORWARD DOCKER DOCKER-USER DOCKER-INGRESS DOCKER-ISOLATION-STAGE-1 DOCKER-ISOLATION-STAGE-2 FORWARD) @preserve;

        chain SMARTSERVER_INPUT;

        chain INPUT {
            jump NETAVARK_INPUT;
            jump SMARTSERVER_INPUT;
        }

        chain SMARTSERVER_FORWARD;

        chain FORWARD {
#            mod conntrack ctstate (RELATED ESTABLISHED) ACCEPT;
#            jump NETAVARK_FORWARD;
#            jump DOCKER-USER;
#            jump DOCKER-ISOLATION-STAGE-1;
#            jump DOCKER;
            jump SMARTSERVER_FORWARD;
            LOG;
            DROP;
        }
    }

    table nat {
        #chain ("/^NETAVARK.*/" NETAVARK-HOSTPORT-MASQ NETAVARK-HOSTPORT-DNAT DOCKER DOCKER-USER DOCKER-INGRESS PREROUTING OUTPUT POSTROUTING) @preserve;
        chain ("/^NETAVARK.*/" NETAVARK-HOSTPORT-MASQ NETAVARK-HOSTPORT-DNAT DOCKER DOCKER-USER DOCKER-INGRESS POSTROUTING) @preserve;

        chain SMARTSERVER_NAT;

        chain PREROUTING {
            mod addrtype dst-type LOCAL jump DOCKER;
            mod addrtype dst-type LOCAL jump NETAVARK-HOSTPORT-DNAT;
            mod addrtype dst-type LOCAL jump SMARTSERVER_NAT;
        }

        chain OUTPUT {
            daddr ! 127.0.0.0/8 mod addrtype dst-type LOCAL jump DOCKER;
            mod addrtype dst-type LOCAL jump NETAVARK-HOSTPORT-DNAT;
            mod addrtype dst-type LOCAL jump SMARTSERVER_NAT;
        }

        chain SMARTSERVER_MASQUERADE;

        chain POSTROUTING {
#            jump NETAVARK-HOSTPORT-MASQ;
            jump SMARTSERVER_MASQUERADE;
        }
    }
}
