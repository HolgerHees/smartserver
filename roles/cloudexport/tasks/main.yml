- name: add user "{{vault_server_vpn_cloud_remote_username}}" with no login
  user:
    name: "{{vault_server_vpn_cloud_remote_username}}"
    uid: 1005
    shell: /sbin/nologin
    home: "{{raid_path}}{{vault_server_vpn_cloud_remote_username}}/"
    create_home: no
    groups: users
    append: no
    
- name: prepare user folder for "{{vault_server_vpn_cloud_remote_username}}"
  file:
    path: "{{raid_path}}{{vault_server_vpn_cloud_remote_username}}/"
    state: directory
    owner: "{{vault_server_vpn_cloud_remote_username}}"
    group: users
    mode: 0777

- name: add nfs exported folder for user "{{vault_server_vpn_cloud_remote_username}}"
  lineinfile:
    path: /etc/exports
    regexp: '^{{item.name}} '
    line: '{{item.name}} {{item.options}}'
  with_items:
    - { name: "{{raid_path}}{{vault_server_vpn_cloud_remote_username}}/", options: "{{ cloud_vpn_endpoint_slave if vault_server_vpn_cloud_type == 'master' else cloud_vpn_endpoint_master }}(rw,root_squash,sync,no_subtree_check)" }
  notify: "restart nfs-server"
