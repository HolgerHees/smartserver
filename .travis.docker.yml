sudo: required

branches:
  only:
    - master
    
services:
  - docker
  
before_install:
- docker pull opensuse/leap:15.1
- docker run --cap-add NET_ADMIN --cap-add SYS_ADMIN --name suse -d -t opensuse/leap:15.1

script:
# git is used to clone the deployment project
# iproute2 is used to change the ip via command line
# hostname is only necessary to install separately for a docker container because on all other distributions it is available by default
# sudo is needed to run ansible as root
# ansible is needed to start the deployment
# and python-xml is needed to install the first additional packages as part of the deployment project
- docker exec -i suse zypper install -y git iproute2 hostname sudo ansible python-xml
- docker exec -i suse ip addr add 192.168.1.50/24 dev eth0:1
- docker exec -i suse git clone https://github.com/HolgerHees/smartserver.git
- docker exec -i suse bash -c "cd smartserver && sudo ansible-playbook -i config/demo/server.ini server.yml"
